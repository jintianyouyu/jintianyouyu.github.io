<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>水泽-信息收集自动化工具</title>
      <link href="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/"/>
      <url>/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<ul><li>我们都是站在巨人的肩膀，所以最开头先写参考链接地址：<a href="https://github.com/0x727/ShuiZe_0x727">https://github.com/0x727/ShuiZe_0x727</a></li></ul><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><ul><li><p>工具下载，下载地址：<a href="https://github.com/0x727/ShuiZe_0x727">https://github.com/0x727/ShuiZe_0x727</a></p></li><li><p>环境准备，根据下载时提供的安装要求</p><ul><li><p>操作系统：ubuntu 20.04.2，提前给ubuntu换好源，我这里用的是阿里源</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721212239481.png"></p></li><li><p>python环境：python3.8</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721212322352.png"></p></li></ul></li></ul><h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><p>使用以下命令</p><pre class="line-numbers language-none"><code class="language-none">chmod 777 build.sh.&#x2F;build.sh   &#x2F;&#x2F;命令执行后就是等待安装完成<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><p>使用以上命令进行安装，看了好多师傅的安装教程，先说一句：可能会报错。刚开始安装挺顺利感觉应该没问题，但是到最后还是报错了，那我们就解决这个错误</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721212448922.png"></p></li></ul><pre class="line-numbers language-none"><code class="language-none">ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.launchpadlib 1.10.13 requires testresources, which is not installed.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>大概意思就是说：有个 testresources 的依赖包没有安装，那么我们手动进行安装，这里使用清华源</p><pre class="line-numbers language-none"><code class="language-none">ip3 install -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple testresources<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后直接运行水泽即可，显示安装完成</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">python3 ShuiZe<span class="token punctuation">.</span>py  <span class="token operator">-</span>h<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721213407314.png"></p><p><strong>安装完成，下面我们开始使用水泽，先看参数，再看文件配置</strong></p><h2 id="水泽参数详解"><a href="#水泽参数详解" class="headerlink" title="水泽参数详解"></a>水泽参数详解</h2><pre class="line-numbers language-none"><code class="language-none">Options:  -h, --help            show this help message and exit  -d DOMAIN, --domain&#x3D;DOMAIN  备案反查顶级域名：-d baidu.com(顶级域名)  -c CSUBNET, --cSubnet&#x3D;CSUBNET                查C端：-c 192.169.1.0,192.168.2.0 或 -c 在过程中获取C端进行扫描  -n ISINTRANET, --intranet&#x3D;ISINTRANET                扫描内网时设置成1  -p PROXY, --proxy&#x3D;PROXY                配置内网代理 socks5 socks4（扫描内网时添加代理使用）  -f FILE, --file&#x3D;FILE  &#x2F;result&#x2F;2ddcaa3ebbd0&#x2F;172.18.82.0.xlsx  检测文件中域名漏洞：-f url.txt（上面给的没看懂）  -w WEAK, --weak&#x3D;WEAK  加载密码脚本  未测试，这里的密码脚本不知道指的是不是字典  -v VPN, --vpn&#x3D;VPN     Run in the case of vpn（未测试）  --web&#x3D;WEB             扫描内网网页  --mn&#x3D;MASNMAPFILE      将masscan与nmap 扫描的结果带入扫描（自己的理解）  --fofaTitle&#x3D;FOFATITLE                        从fofa里收集title的资产，然后漏洞检测:--fofaTitle 牛津大学  --domainFile&#x3D;DOMAINFILE                        批量跑根域名列表：--domainFile domain.txt  --ksubdomain&#x3D;KSUBDOMAIN                        不调用ksubdomain爆破子域名  --test&#x3D;TESTDEMO       演示测试扫描(扫描示例)：如果 test&#x3D;1 运行测试演示  --justInfoGather&#x3D;JUSTINFOGATHER                        仅信息收集，不检测漏洞：--justInfoGather 1  --getSocks&#x3D;GETSOCKS   get socks（没懂）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>参数使用样例</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>d domain<span class="token punctuation">.</span>compython3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>d domain<span class="token punctuation">.</span>com <span class="token operator">-</span><span class="token operator">-</span>justInfoGather <span class="token number">1</span>python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>d domain<span class="token punctuation">.</span>com <span class="token operator">-</span><span class="token operator">-</span>ksubdomain <span class="token number">0</span>python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>c <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token number">.2</span><span class="token number">.0</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.0</span>python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>f url<span class="token punctuation">.</span>txtpython3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>n <span class="token number">1</span> <span class="token operator">-</span>c <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token number">.2</span><span class="token number">.0</span> <span class="token operator">-</span>p <span class="token number">1.1</span><span class="token number">.1</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">1111</span>python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>n <span class="token number">1</span> <span class="token operator">-</span>f url<span class="token punctuation">.</span>txt <span class="token operator">-</span>p <span class="token number">1.1</span><span class="token number">.1</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">1111</span> <span class="token operator">-</span><span class="token operator">-</span>web <span class="token number">1</span>python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>n <span class="token number">1</span> <span class="token operator">-</span>c <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.0</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token number">.2</span><span class="token number">.0</span> <span class="token operator">-</span>v <span class="token number">1</span>proxychains4 python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>n <span class="token number">1</span> <span class="token operator">-</span>f <span class="token operator">/</span>result<span class="token operator">/</span>2ddcaa3ebbd0<span class="token operator">/</span><span class="token number">172.18</span><span class="token number">.82</span><span class="token number">.0</span><span class="token punctuation">.</span>xlsxproxychains4 python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span>n <span class="token number">1</span> <span class="token operator">-</span>w <span class="token number">1</span> <span class="token operator">-</span>f <span class="token operator">/</span>result<span class="token operator">/</span>2ddcaa3ebbd0<span class="token operator">/</span><span class="token number">172.18</span><span class="token number">.82</span><span class="token number">.0</span><span class="token punctuation">.</span>xlsxpython3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>mn masNmap<span class="token punctuation">.</span>xlsxpython3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>mn masNmap<span class="token punctuation">.</span>xlsx <span class="token operator">-</span>w <span class="token number">1</span>python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>fofaTitle 大学python3 ShuiZe<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>domainFile domain<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>如果时间足够，并且外部打点，建议直接使用 -d 参数，一路到底，可最大程度收集到有用信息</strong></p><h3 id="d：备案反查顶级域名"><a href="#d：备案反查顶级域名" class="headerlink" title="-d：备案反查顶级域名"></a>-d：备案反查顶级域名</h3><p>该参数功能（显示信息比较多，这里简单列出个人感觉比较重要的功能）</p><ul><li><p>获取网站的备案信息，并获取改网站所在公司的所有子公司</p><ul><li>攻防可通过其他子公司打入</li></ul></li><li><p>获取网站所有公司以及子公司的备案信息，包括：电话、邮箱等</p><ul><li><p>可社工利用</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721215539815.png"></p></li></ul></li><li><p>不是泛解析，调用ksubdomain爆破子域名，并获取子域名的IP地址</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721215921082.png"></p></li><li><p>theHarvest获取邮箱：这个本次测试没看到</p></li><li><p>通过第三方数据接口—获取子域名</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721223124415.png"></p></li><li><p>通过github–获取子域名，将结果导入到 txt 文件中，路径会在扫描结束后显示</p><ul><li>这里需要添加 github 的key</li></ul><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721223251921.png"></p></li><li><p>调用百度与必应的搜索语法，爬取网站链接：子域名、后台等</p><ul><li>这里简单看了下，感觉使用了搜索引擎的语法（不知道对不对）</li></ul><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721222704546.png"></p></li><li><p>显示证书</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721223621010.png"></p></li><li><p>子域名友链</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721223851233.png"></p></li><li><p>以下四个放到一起理解：解析子域名A记录,检测是否CDN和整理C段的IP</p><ul><li><p>解析子域名A记录，检测是否CDN</p><ul><li>CDN：理解为网站的本地缓存，访问的IP并不是真正服务器的IP地址，而是缓存服务器的IP地址，目的是为了加快访问速度</li></ul><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721224454751.png"></p></li><li><p>这个理C端IP地址</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721224815433.png"></p></li></ul></li><li><p>资产测绘平台：fofa，shodan，quake，qianxin</p><ul><li>需要添加对应的key</li></ul><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721225043727.png"></p></li><li><p>IP反查域名</p><ul><li>使用网站：<a href="https://webscan.cc/">https://webscan.cc/</a></li></ul><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721225559396.png"></p></li><li><p>探测扫描到的IP地址与URL存活</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721225733917.png"></p></li><li><p>漏洞检测，web漏洞、cms漏洞等</p><p><img src="/2022/07/21/%E6%B0%B4%E6%B3%BD-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7/image-20220721230114752.png"></p></li><li><p>最终结果保存在表格与txt文件中</p><ul><li>这个就比较明确不再赘述，表格中写的很清楚</li></ul></li></ul><h2 id="POC编写"><a href="#POC编写" class="headerlink" title="POC编写"></a>POC编写</h2><p>水泽中有漏洞验证模块，使用水泽自己的POC模板编写POC进行添加</p><pre class="line-numbers language-none"><code class="language-none">POC的模板文件例子：Plugins&#x2F;Vul&#x2F;Web&#x2F;__template__.py只需要在run_detect方法里调用POC的利用方法即可<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="API配置"><a href="#API配置" class="headerlink" title="API配置"></a>API配置</h2><p>配置文件地址：<code>iniFile/config.ini</code></p><p>方法简单不再赘述，打开照着配置即可</p>]]></content>
      
      
      <categories>
          
          <category> 器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 信息收集自动化工具 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
